Тема: совместная работа с файлами, понятие блокировок.

Представим, что мы работаем в примитивной файловой системе без каких-либо файловых блокировок. Требуется создать собственную библиотеку файловых блокировок на основе создания файлов <myfile>.lck, где <myfile> — имя блокируемого файла.

Алгоритм работы:

Проверить существование файла lck: если не существует, то создать, если существует, то заблокироваться до его удаления.
Записать в этот файл свой pid.
Выполнить чтение/запись файла.
Проверить, что файл существует и в нем записан свой pid. Если это так, то удалить файл, если нет — завершиться с сообщением об ошибке.
Убедиться, что программа ломается на снятии блокировки: сделать скрипт, который будет запускать программу блокировки, а потом удалять/портить lck файл.

Написать в runme.sh тестовый скрипт, который запустит в параллель 10 задач, каждая из которых в бесконечном цикле блокирует общий файл на 1 секунду, а потом снимает блокировку. Писать или читать общий файл не обязательно. Через пять минут завершить все десять задач сигналом sigint. В задачах вести статистику количества успешных блокировок. По сигналу sigint задача должна сохранить статистику блокировок в общий файл статистики и завершиться. Убедиться, что задачи не падают из-за порчи lck файла (гонки). Убедиться, что файл статистики содержит по одной строке на каждую задачу. Убедиться, что статистика блокировок для всех процессов примерно одинакова (нет тупиков).